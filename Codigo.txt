Imports System.Diagnostics
Imports System.IO

Public Class Form1

    Private Sub btnDescargar_Click(sender As Object, e As EventArgs) Handles btnDescargar.Click
        Dim url As String = txtURL.Text.Trim() ' Obtener la URL del TextBox

        If Not String.IsNullOrEmpty(url) Then
            Try
                ' Obtener la ruta del escritorio
                Dim desktopPath As String = Environment.GetFolderPath(Environment.SpecialFolder.DesktopDirectory)

                ' Crear un nombre de archivo único usando la fecha y hora actual
                Dim timestamp As String = DateTime.Now.ToString("yyyyMMdd_HHmmss")
                Dim filePath As String = Path.Combine(desktopPath, $"video_descargado_{timestamp}.mp4")

                ' Ruta del yt-dlp
                Dim ytDlpPath As String = "C:\Cambialo\por la ruta\de tu archivo\yt-dlp.exe"

                ' Configurar el proceso
                Dim process As New Process()
                process.StartInfo.FileName = ytDlpPath
                process.StartInfo.Arguments = $"-f mp4 {url} -o ""{filePath}"""

                ' Redirigir salida y errores
                process.StartInfo.UseShellExecute = False
                process.StartInfo.RedirectStandardOutput = True
                process.StartInfo.RedirectStandardError = True
                process.StartInfo.CreateNoWindow = True

                ' Iniciar el proceso
                process.Start()

                ' Leer la salida y los errores
                Dim output As String = process.StandardOutput.ReadToEnd()
                Dim errors As String = process.StandardError.ReadToEnd()

                ' Esperar a que el proceso termine
                process.WaitForExit()

                ' Verificar el código de salida
                If process.ExitCode = 0 Then
                    MessageBox.Show($"Video descargado exitosamente en: {filePath}")
                    txtURL.Text = ""

                    ' Reproducir el archivo descargado
                    System.Diagnostics.Process.Start(filePath)
                Else
                    MessageBox.Show($"Error en la descarga: {errors}")
                End If

            Catch ex As Exception
                MessageBox.Show($"Error al descargar el video: {ex.Message}")
            End Try
        Else
            MessageBox.Show("Por favor ingresa una URL válida.")
        End If
    End Sub

    Private Sub Form1_Load(sender As Object, e As EventArgs) Handles MyBase.Load

    End Sub
End Class